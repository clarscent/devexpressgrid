<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>이벤트 테스트 그리드</title>
<link rel="stylesheet" type="text/css" href="./css/dx.common.css"/>
<link rel="stylesheet" type="text/css" href="./css/dx.grid.custom.css"/>
<script src="js/jquery-3.5.1.js"></script>
<script src="js/lodash-4.17.15.min.js"></script>
<script src="js/jszip.min.js"></script>
<script src="js/dx.custom.js"></script>
<!--<script src="./js/dx.all.debug.origin.js"></script>-->
<script src="js/dx.grid.js"></script>
<script src="test.js"></script>

<style>
.form-content {
	margin-bottom: 30px;
}

.redText {
	color: red;
	font-weight: bold;
}
</style>

<script type="text/javascript">
$(document).ready(function () {
	$("button[data-type='addRow']").on("click", function(evt) {
		$el = $(evt.currentTarget);
		let gridID = $el.attr("data-grid-id");
		dxGrid.addRow(gridID, undefined);
	});

	$("button[data-type='deleteCheckedRow']").on("click", function(evt) {
		$el = $(evt.currentTarget);
		let gridID = $el.attr("data-grid-id");
		dxGrid.deleteCheckedRow(gridID);
	});

	$("button[data-type='checkedRow']").on("click", function(evt) {
		$el = $(evt.currentTarget);
		let gridID = $el.attr("data-grid-id");
		let checkedData = dxGrid.getCheckedData(gridID);
		console.log("<<<checkedData>>>", checkedData);
	});

	$("button[data-type='getGridData']").on("click", function(evt) {
		$el = $(evt.currentTarget);
		let gridID = $el.attr("data-grid-id");
		let allData = dxGrid.getGridData(gridID)
		console.log("<<<all Data>>>", allData);
	});

	$("button[data-type='setEmptyGrid']").on("click", function(evt) {
		$el = $(evt.currentTarget);
		let gridID = $el.attr("data-grid-id");
		dxGrid.setEmptyGrid(gridID);
	});

	$("button[data-type='exportToExcel']").on("click", function(evt) {
		$el = $(evt.currentTarget);
		let gridID = $el.attr("data-grid-id");
		dxGrid.exportToExcel(gridID);
	});

	$("button[data-type='getRowIndex']").on("click", function(evt) {
		$el = $(evt.currentTarget);
		let gridID = $el.attr("data-grid-id");
		let rowIndex = dxGrid.getRowIndex(gridID);
		console.log("rowIndex", rowIndex);
	});
});

</script>

</head>
<body class="dx-viewport">
<h2>이벤트 테스트</h2>
<div class="form-content">
	<div>
		<button type="button" data-type="addRow" data-grid-id="readOrEditGridContainer">신규</button>
		<button type="button" data-type="deleteCheckedRow" data-grid-id="readOrEditGridContainer">선택행 삭제</button>
		<button type="button" data-type="checkedRow" data-grid-id="readOrEditGridContainer">선택행 가져오기(console)</button>
		<button type="button" data-type="getGridData" data-grid-id="readOrEditGridContainer">그리드 모든 데이터 가져오기(console)</button>
		<br><br>
		<button type="button" data-type="setEmptyGrid" data-grid-id="readOrEditGridContainer">빈 그리드 만들기</button>
		<button type="button" data-type="exportToExcel" data-grid-id="readOrEditGridContainer">엑셀 파일 추출</button>
		<button type="button" data-type="getRowIndex" data-grid-id="readOrEditGridContainer">행의 index 반환(console)</button>
	</div>
	<br>
	<div class="grid-container" id="readOrEditGridContainer"></div>
</div>

<script>
Listener.grid.onInitialized = function (gridName) {
	fn_gridInit();
}
Listener.grid.onRowClick = function (gridName, rowIndex, rowData) {
	grid_rowClick(gridName, rowIndex, rowData);
}
Listener.grid.onKeyDown = function (gridName, rowIndex, cellIndex, cellName, value, keyCode, rowData) {
	if (keyCode == 13) { // Enter
		grid_rowEnter(gridName, rowIndex, rowData);
	} else if (keyCode == 112) { // F1
		grid_helpClick(gridName, rowIndex, cellIndex, cellName, rowData);
	}
	grid_onKeyDown(gridName, rowIndex, cellIndex, cellName, value, keyCode, rowData);
	grid_onChange(gridName, rowIndex, cellIndex, cellName, rowData);
}

function fn_gridInit() {
	Logger.info("fn_gridInit()");
}

function grid_rowClick (gridName, rowIndex, rowData) {
	Logger.info("grid_rowClick()");
	Logger.info("gridName", gridName);
	Logger.info("rowIndex", rowIndex);
	Logger.info("rowData", rowData);
}

function grid_rowEnter (gridName, rowIndex, rowData) {
	Logger.info("grid_rowEnter()");
	Logger.info("gridName", gridName);
	Logger.info("rowIndex", rowIndex);
	Logger.info("rowData", rowData);
}

function grid_helpClick (gridName, rowIndex, cellIndex, cellName, rowData) {
	Logger.info("grid_helpClick()");
	Logger.info("gridName", gridName);
	Logger.info("rowIndex", rowIndex);
	Logger.info("cellIndex", cellIndex);
	Logger.info("cellName", cellName);
	Logger.info("rowData", rowData);
}

function grid_onKeyDown (gridName, rowIndex, cellIndex, cellName, cellValue, keyCode, rowData) {
	Logger.info("grid_onKeyDown()");
	Logger.info("gridName", gridName);
	Logger.info("rowIndex", rowIndex);
	Logger.info("cellIndex", cellIndex);
	Logger.info("cellName", cellName);
	Logger.info("cellValue", cellValue);
	Logger.info("keyCode", keyCode);
	Logger.info("rowData", rowData);
}

function grid_onChange (gridName, rowIndex, cellIndex, cellName, rowData) {
	Logger.info("grid_onChange()");
	Logger.info("gridName", gridName);
	Logger.info("rowIndex", rowIndex);
	Logger.info("cellIndex", cellIndex);
	Logger.info("cellName", cellName);
	Logger.info("rowData", rowData);
}

$(document).ready(function () {
	let band, footer, gridID = "readOrEditGridContainer";
	let columns = [];
	
	var colConfig = new Array();

	colConfig.push({"title":"대분류",		"fieldName":"BRD_GRP1_NM",	"width":"110", "bandIndex":"0", "align":"center", "type":"textEdit",  "readOnly":"Y", "sorting":"Y","filtering":"Y", "grouping":"Y"});
	colConfig.push({"title":"중분류",		"fieldName":"BRD_GRP2_NM",  "width":"110", "bandIndex":"0", "align":"center", "type":"textEdit",  "readOnly":"Y", "sorting":"Y","filtering":"Y", "grouping":"Y"});
	colConfig.push({"title":"상품코드",		"fieldName":"PROD_CD", 		"width":"100", "bandIndex":"0", "align":"center", "type":"textEdit",  "readOnly":"Y", "sorting":"Y","filtering":"Y", "grouping":"Y"});
	colConfig.push({"title":"상품명", 		"fieldName":"PROD_NAME", 	"width":"80", "bandIndex":"0", "align":"left",   "type":"textEdit",  "readOnly":"Y", "sorting":"Y","filtering":"Y", "grouping":"Y","maxLength":"400"});
	colConfig.push({"title":"재고수량",		"fieldName":"STK_QTY", 		"width":"80",  "bandIndex":"1", "align":"right", "visible":"false","fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"매장수량",		"fieldName":"STORE_STK_QTY", 		"width":"80",  "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"택배수량",		"fieldName":"WT_QTY", 		"width":"80",  "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"출고확정",		"fieldName":"OUT_QTY", 		"width":"80",  "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"지시대기",		"fieldName":"REQ_WT_QTY", 		"width":"80",  "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"출고대기",		"fieldName":"OUT_WT_QTY", 		"width":"80",  "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"재고금액(소비자가)", 	"fieldName":"STK_AMT1", "width":"150", "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
    colConfig.push({"title":"재고금액(평균단가)", 	"fieldName":"STK_AMT2", "width":"150", "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
    colConfig.push({"title":"재고금액(매입단가)", 	"fieldName":"STK_AMT3", "width":"150", "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
    colConfig.push({"title":"소비자가", 	    "fieldName":"TAG_PRICE", 	"width":"90",  "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "type":"textEdit",  "filtering":"Y", "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"매입단가", 		"fieldName":"COST_PRICE", 	"width":"80",  "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	colConfig.push({"title":"평균단가",   	"fieldName":"AVG_PRICE", 	"width":"100", "bandIndex":"1", "align":"right", "fieldsType":"float", "format":"#,##0", "footerKind":"sum", "filtering":"Y", "type":"textEdit",  "readOnly":"Y", "sorting":"Y", "grouping":"Y"});
	
	// column : caption,datafield,width,datatype,option [ readonly,maxlength,align,visible,datasource,parentdatafield,codenamefield,cellstyle,headerstyle ]
	// datatype : string: text, number, percent, date, check, password, codeHelp, selectBox,
	
	
	for (var i = 0; i < colConfig.length; i++) {
	    /* console.log("title:"+colConfig[i].title );
	    console.log("fieldName:"+colConfig[i].fieldName );
	    console.log("width:"+colConfig[i].width );
	    console.log("bandIndex:"+colConfig[i].bandIndex );
	    console.log("align:"+colConfig[i].align );
	    console.log("type:"+colConfig[i].type );
	    console.log("readOnly:"+colConfig[i].readOnly );
	    console.log("sorting:"+colConfig[i].sorting );
	    console.log("filtering:"+colConfig[i].filtering );
	    console.log("grouping:"+colConfig[i].grouping ); */
	    
	    var datatype;
	    if(colConfig[i].fieldsType == "float"){
	    	datatype = "number";
	    }else {
	    	datatype = "text";
	    }
	    
	    var options = {};
	    // if(colConfig[i].readOnly=="Y"){
		// 	options = {"readonly" : true };
	    // }
	    if (colConfig[i].visible == "false") {
	    	_.merge(options, {"visible": false});
		}

	    columns.push( new Column(colConfig[i].title,colConfig[i].fieldName,colConfig[i].width,datatype,options));
	    
	}

	dxGrid.initGrid(gridID, "100%", 500, { checkbox: true, editable: false, sortable: true } );
	dxGrid.setColumn(gridID, columns, band);

	dxGrid.setGridData(gridID, testData);
	
	// Footer 설정
	// dxGrid.setFooter(gridID, footer);

});

</script>

</body>
</html>